
TARGET="string"
GROUP="Libraries"

SOURCES_DIR=$CHAOS_SOURCES/$GROUP/$TARGET
ARCHIVES_DIR=$CHAOS_ARCHIVES/$GROUP

case "$1" in
"-r") 
	BUILD=Release
	COMPILE_FLAGS="-O3 -funroll-loops -fomit-frame-pointer"
    PREPROCESSOR_FLAGS="-D__STORM_PROGRAM__"
    ;;
"-d") 
	BUILD=Debug
    COMPILE_FLAGS="-O0 -g"
    PREPROCESSOR_FLAGS=""
    ;;
"-g") 
	BUILD=DebugGDB
    COMPILE_FLAGS="-O0 -g -ggdb"
    PREPROCESSOR_FLAGS="-D__STORM_KERNEL__ -DGDB -DGDB_PORT=0 -DGDB_SPEED=9600"
    ;;
"-as")
	DATE_STRING=`date +%Y%m%d`
	make -s package-source \
    	date_string="$DATE_STRING" \
	    source_directory=$SOURCES_DIR \
        archive_directory="$ARCHIVES_DIR" \
	    --makefile=$SOURCES_DIR/Makefile
	exit
	;;
*) exit
esac

BINARIES_DIR=$CHAOS_BINARIES/$BUILD/$GROUP
OBJECTS_DIR=$CHAOS_OBJECTS/$BUILD/$GROUP/$TARGET

LOG_FILE=$OBJECTS_DIR/log

mkdir -p $BINARIES_DIR
mkdir -p $OBJECTS_DIR

make -s deps \
    preprocessor_flags="$PREPROCESSOR_FLAGS" \
    include_directories="$CHAOS_INCLUDES" \
    source_directory=$SOURCES_DIR \
    destination_directory=$BINARIES_DIR \
    --directory=$OBJECTS_DIR \
    --makefile=$SOURCES_DIR/Makefile


make -s \
	target="$TARGET" \
    compile_flags="$COMPILE_FLAGS" \
    preprocessor_flags="$PREPROCESSOR_FLAGS" \
    include_directories="$CHAOS_INCLUDES" \
    library_directories="$CHAOS_LIBRARIES" \
    source_directory=$SOURCES_DIR \
    destination_directory=$BINARIES_DIR \
    --directory=$OBJECTS_DIR \
    --makefile=$SOURCES_DIR/Makefile

