# This makefile was generated by autochaos 0.2.1. Please do not
# tamper with it unless you are very certain about what you are doing.

ALL_ARGUMENTS = 

PREFIX = /mnt/chaos
PACKAGE = storm

# Compiler flags.

CFLAGS = -Wall -W -Wshadow -Wpointer-arith -Waggregate-return \
-Wstrict-prototypes -Wredundant-decls -Winline -Wmissing-prototypes \
-Werror -Wcast-align -Wbad-function-cast -Wsign-compare \
-Wmissing-declarations -Wmissing-noreturns -pipe \
-Wnested-externs -O3 -fno-builtin -funsigned-char -g -fomit-frame-pointer -ffreestanding $(EXTRA_CFLAGS) $(DEFINES)

INCLUDES = \
-I../include \
-I.. \
-I. -I$(PREFIX)/data/programming/c/headers

ALL_OBJECTS = \
ia32/cluster.o \
ia32/cpuid.o \
ia32/fpu.o \
ia32/debug.o \
ia32/dispatch.o \
ia32/dma.o \
ia32/elf.o \
ia32/gdt.o \
ia32/idt.o \
ia32/init.o \
ia32/irq.o \
ia32/irq_handlers.o \
ia32/limits.o \
ia32/main.o \
ia32/memory.o \
ia32/memory_global.o \
ia32/memory_physical.o \
ia32/memory_virtual.o \
ia32/multiboot.o \
ia32/mutex.o \
ia32/port.o \
ia32/process.o \
ia32/schedule.o \
ia32/string.o \
ia32/system_calls-auto.o \
ia32/system_calls.o \
ia32/thread.o \
ia32/time.o \
ia32/timer.o \
ia32/trap.o \
ia32/trap_handlers.o \
ia32/wrapper.o

STATIC_LIBRARY_PATH = $(PREFIX)/data/programming/libraries/static

# Ideally, this would be -lwhatever, but we have not started patching
# the GNU tools yet...

LIBS = 

OBJECTS =  \
cluster.o \
cpuid.o \
fpu.o \
debug.o \
dispatch.o \
dma.o \
elf.o \
gdt.o \
idt.o \
init.o \
irq.o \
irq_handlers.o \
limits.o \
main.o \
memory.o \
memory_global.o \
memory_physical.o \
memory_virtual.o \
multiboot.o \
mutex.o \
port.o \
process.o \
schedule.o \
string.o \
system_calls-auto.o \
system_calls.o \
thread.o \
time.o \
timer.o \
trap.o \
trap_handlers.o \
wrapper.o


SOURCES =  \
cluster.c \
cpuid.c \
fpu.c \
debug.c \
dispatch.c \
dma.c \
elf.c \
gdt.c \
idt.c \
init.c \
irq.c \
irq_handlers.S \
limits.c \
main.c \
memory.c \
memory_global.c \
memory_physical.c \
memory_virtual.c \
multiboot.c \
mutex.c \
port.c \
process.c \
schedule.c \
string.c \
system_calls-auto.c \
system_calls.c \
thread.c \
time.c \
timer.c \
trap.c \
trap_handlers.S \
wrapper.c

HEADER_PATH = $(PREFIX)/data/programming/c/headers/$(PACKAGE)/ia32

# TODO: Those should be overridable.

CC = gcc
NASM = nasm
AR = ar
RANLIB = ranlib
GZIP = gzip -f

%.o: %.c
	@echo Compiling $<...
	@$(CC) -o $(@) $(CFLAGS) $(INCLUDES) $(DEFS) -c $<
	@$(CC) -M $< $(CFLAGS) $(INCLUDES) $(DEFS) > $(*F).dep

%.o: %.S
	@echo Compiling $<...
	@$(CC) -o $(@) $(CFLAGS) $(INCLUDES) $(DEFS) -c $<
	@$(CC) -M $< $(CFLAGS) $(INCLUDES) $(DEFS) > $(*F).dep

%.o: %.asm
	$(NASM) -o $(@) $< -f elf

.PHONY: splash all clean install package-source package-check package

all: splash makefile $(OBJECTS)

clean:
	rm -f $(OBJECTS)
	rm -f *.dep
	-$(MAKE) clean-local
splash:


LDFLAGS = -nostdlib -Wl,-T,current-arch/kernel.ld -lgcc $(EXTRA_LDFLAGS)

storm: $(OBJECTS) $(ALL_OBJECTS)
	@echo "Linking..."
	@$(CC) -o $(@) $(OBJECTS) $(ALL_OBJECTS) $(LIBS) $(LDFLAGS)

install: all

package-source:
	mkdir -p /root/Development/chaos.n3/storm/package-source/ia32
	-cp -f makefile.template $(EXTRA_FILES) /root/Development/chaos.n3/storm/package-source/ia32
	for source in $(SOURCES) ; do cp $$source /root/Development/chaos.n3/storm/package-source/ia32 || exit ; done
package-check: package-source
	     cd package-source && ./configure $(ALL_ARGUMENTS) && $(MAKE) && $(MAKE) clean
	     find package-source -name makefile -exec rm {} ';'
	     rm package-source/config.h
package: package-check
	rm -rf storm-0.5.0
	mv package-source storm-0.5.0
	tar cvIf storm-0.5.0.tar.bz2 storm-0.5.0
	     
-include cluster.dep
-include cpuid.dep
-include fpu.dep
-include debug.dep
-include dispatch.dep
-include dma.dep
-include elf.dep
-include gdt.dep
-include idt.dep
-include init.dep
-include irq.dep
-include irq_handlers.dep
-include limits.dep
-include main.dep
-include memory.dep
-include memory_global.dep
-include memory_physical.dep
-include memory_virtual.dep
-include multiboot.dep
-include mutex.dep
-include port.dep
-include process.dep
-include schedule.dep
-include string.dep
-include system_calls-auto.dep
-include system_calls.dep
-include thread.dep
-include time.dep
-include timer.dep
-include trap.dep
-include trap_handlers.dep
-include wrapper.dep

# $Id: makefile.template,v 1.2 2001/02/10 21:26:00 jojo Exp $
# Local rules

wrapper.c system_calls-auto.c: system_calls.pl
	@./system_calls.pl

DEFINES="-DCREATOR=\"`whoami`@`hostname`\""
EXTRA_FILES=system_calls.pl kernel.ld