# This makefile was generated by autochaos 0.3.0. Please do not
# tamper with it unless you are very certain about what you are doing.

ALL_ARGUMENTS = 

PREFIX = /mnt/chaos
PACKAGE = storm

# Compiler flags.

#DEFS = -D__STORM_KERNEL__
DEFS = -D__STORM_KERNEL_MODULE__

CFLAGS = -Wall -W -Wshadow -Wpointer-arith -Waggregate-return \
-Wstrict-prototypes -Wredundant-decls -Winline -Wmissing-prototypes \
-Wcast-align -Wbad-function-cast -Wsign-compare \
-Wmissing-declarations -Wmissing-noreturns -pipe \
-Wnested-externs -O3 -fno-builtin -funsigned-char -g -fomit-frame-pointer -ffreestanding $(EXTRA_CFLAGS) $(DEFINES)

# Linker extra flags
EXTRA_LDFLAGS = 

INCLUDES = -I../.. -I../../../Include

OBJECTS = stdio.o stdlib.o unistd.o wait.o times.o time.o termios.o signal.o \
    string.o strings.o stat.o socket.o resource.o setjmp.o libio.o pwd.o \
    dirent.o errno.o fcntl.o ctype.o
LIBS = 
SOURCES =  stdio.c stdlib.c unistd.c wait.c times.c time.c termios.c signal.c \
    string.c strings.c stat.c socket.c resource.c setjmp.c libio.c pwd.c \
    dirent.c errno.c fcntl.c ctype.c

HEADER_PATH = $(PREFIX)/data/programming/c/headers/$(PACKAGE)/ia32

# TODO: Those should be overridable.

CC = gcc
NASM = nasm
AR = ar
RANLIB = ranlib
GZIP = gzip -f

%.o: %.c
	@echo Compiling $<... for $(DEFS)
	@$(CC) -o $(@) $(CFLAGS) $(INCLUDES) $(DEFS) -c $<

%.o: %.S
	@echo Compiling $<...
	@$(CC) -o $(@) $(CFLAGS) $(INCLUDES) $(DEFS) -c $<
	@$(CC) -M $< $(CFLAGS) $(INCLUDES) $(DEFS) > $(*F).dep

%.o: %.asm
	$(NASM) -o $(@) $< -f elf

.PHONY: splash all clean install package-source package-check package

all: splash makefile  $(OBJECTS)

clean:
	rm -f $(OBJECTS)
	rm -f posix.a
	
splash:

posix.a: $(OBJECTS)
	@echo "Linking..."
	ar cru $(@) $(OBJECTS) $(LIBS)
	ranlib $(@)

all: posix.a

rall: clean all

install: all

