<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-
1">
<title>API documentation for Storm</title>
<style type="text/css">

BODY { background-color: #e0e0ff; }
H1 { text-align: center; }
CAPTION { font-weight: bold }
A { color: #000066; text-decoration: none; font-weight: bold; }
A.qindex {}
A.qindexRef {}
A.el { text-decoration: none; font-weight: bold }
A.elRef { font-weight: bold }
A.code { text-decoration: none; font-weight: normal; color: #4444ee }
A.codeRef { font-weight: normal; color: #4444ee }
A:hover { text-decoration: underline; background-color: #f2f2ff }
A:visited { color: #000066; }
DL.el { margin-left: -1cm }
DIV.fragment { width: 100%; border: none; background-color: #eeeeee }
DIV.ah { background-color: black; font-weight: bold; color: #ffffff; margin-bottom: 3px; margin-top: 3px }
TD.md { background-color: #f2f2ff; font-weight: bold; }
TD.mdname1 { background-color: #f2f2ff; font-weight: bold; color: #602020; }
TD.mdname { background-color: #f2f2ff; font-weight: bold; color: #602020; width: 600px; }
DIV.groupHeader { margin-left: 16px; margin-top: 12px; margin-bottom: 6px; font-weight: bold }
DIV.groupText { margin-left: 16px; font-style: italic; font-size: smaller }
TR, TD, TABLE { padding: 0 0 0 0; margin: 0 0 0 0; }
TD.indexkey { 
   background-color: #d0d0ff; 
   font-weight: bold; 
   padding-right  : 10px; 
   padding-top    : 2px; 
   padding-left   : 10px; 
   padding-bottom : 2px; 
   margin-left    : 0px; 
   margin-right   : 0px; 
   margin-top     : 0px; 
   margin-bottom  : 0px  
}
TD.indexvalue { 
   background-color: #d0d0ff; 
   font-style: italic; 
   padding-right  : 10px; 
   padding-top    : 2px; 
   padding-left   : 10px; 
   padding-bottom : 2px; 
   margin-left    : 0px; 
   margin-right   : 0px; 
   margin-top     : 0px; 
   margin-bottom  : 0px  
}
span.keyword       { color: #008000 }
span.keywordtype   { color: #604020 }
span.keywordflow   { color: #e08000 }
span.comment       { color: #800000 }
span.preprocessor  { color: #806020 }
span.stringliteral { color: #002080 }
span.charliteral   { color: #008080 }

BODY, TD { font-family: tahoma, verdana, arial, sansserif; font-size: 11px; }

</style>
</head><body>
<center><a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="functions.html">Data Structure Members List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; </center>


<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>smp.h</h1><a href="smp_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#ifndef __ASM_SMP_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define __ASM_SMP_H</span>
00003 <span class="preprocessor"></span>
00004 <span class="comment">/*</span>
00005 <span class="comment"> * We need the APIC definitions automatically as part of 'smp.h'</span>
00006 <span class="comment"> */</span>
00007 <span class="preprocessor">#ifndef __ASSEMBLY__</span>
00008 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/config.h&gt;</span>
00009 <span class="preprocessor">#include &lt;linux/threads.h&gt;</span>
00010 <span class="preprocessor">#include &lt;linux/ptrace.h&gt;</span>
00011 <span class="preprocessor">#endif</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#ifdef CONFIG_X86_LOCAL_APIC</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#ifndef __ASSEMBLY__</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#include &lt;asm/fixmap.h&gt;</span>
00016 <span class="preprocessor">#include &lt;asm/bitops.h&gt;</span>
00017 <span class="preprocessor">#include &lt;asm/mpspec.h&gt;</span>
00018 <span class="preprocessor">#ifdef CONFIG_X86_IO_APIC</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#include &lt;asm/io_apic.h&gt;</span>
00020 <span class="preprocessor">#endif</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#include &lt;asm/apic.h&gt;</span>
00022 <span class="preprocessor">#endif</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#ifdef CONFIG_SMP</span>
00026 <span class="preprocessor"></span><span class="preprocessor"># ifdef CONFIG_MULTIQUAD</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#  define TARGET_CPUS 0xf     </span><span class="comment">/* all CPUs in *THIS* quad */</span>
00028 <span class="preprocessor">#  define INT_DELIVERY_MODE 0     </span><span class="comment">/* physical delivery on LOCAL quad */</span>
00029 <span class="preprocessor"># else</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#  define TARGET_CPUS cpu_online_map</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#  define INT_DELIVERY_MODE 1     </span><span class="comment">/* logical delivery broadcast to all procs */</span>
00032 <span class="preprocessor"># endif</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00034"></a><a class="code" href="smp_8h.html#a0">00034</a> <span class="preprocessor"></span><span class="preprocessor"># define INT_DELIVERY_MODE 1     </span><span class="comment">/* logical delivery */</span>
<a name="l00035"></a><a class="code" href="smp_8h.html#a1">00035</a> <span class="preprocessor"># define TARGET_CPUS 0x01</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#ifndef clustered_apic_mode</span>
00039 <span class="preprocessor"></span><span class="preprocessor"> #ifdef CONFIG_MULTIQUAD</span>
00040 <span class="preprocessor"></span><span class="preprocessor">  #define clustered_apic_mode (1)</span>
00041 <span class="preprocessor"></span><span class="preprocessor">  #define esr_disable (1)</span>
00042 <span class="preprocessor"></span><span class="preprocessor"> #else </span><span class="comment">/* !CONFIG_MULTIQUAD */</span>
<a name="l00043"></a><a class="code" href="smp_8h.html#a2">00043</a> <span class="preprocessor">  #define clustered_apic_mode (0)</span>
<a name="l00044"></a><a class="code" href="smp_8h.html#a3">00044</a> <span class="preprocessor"></span><span class="preprocessor">  #define esr_disable (0)</span>
00045 <span class="preprocessor"></span><span class="preprocessor"> #endif </span><span class="comment">/* CONFIG_MULTIQUAD */</span>
00046 <span class="preprocessor">#endif </span>
00047 <span class="preprocessor"></span>
00048 <span class="preprocessor">#ifdef CONFIG_SMP</span>
00049 <span class="preprocessor"></span><span class="preprocessor">#ifndef __ASSEMBLY__</span>
00050 <span class="preprocessor"></span>
00051 <span class="comment">/*</span>
00052 <span class="comment"> * Private routines/data</span>
00053 <span class="comment"> */</span>
00054  
00055 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="smpboot_8c.html#a39">smp_alloc_memory</a>(<span class="keywordtype">void</span>);
00056 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> phys_cpu_present_map;
00057 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="smpboot_8c.html#a4">cpu_online_map</a>;
00058 <span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> smp_invalidate_needed;
00059 <span class="keyword">extern</span> <span class="keywordtype">int</span> pic_mode;
00060 <span class="keyword">extern</span> <span class="keywordtype">void</span> smp_flush_tlb(<span class="keywordtype">void</span>);
00061 <span class="keyword">extern</span> <span class="keywordtype">void</span> smp_message_irq(<span class="keywordtype">int</span> cpl, <span class="keywordtype">void</span> *dev_id, <span class="keyword">struct</span> pt_regs *regs);
00062 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="smp_8c.html#a27">smp_send_reschedule</a>(<span class="keywordtype">int</span> cpu);
00063 <span class="keyword">extern</span> <span class="keywordtype">void</span> smp_invalidate_rcv(<span class="keywordtype">void</span>);       <span class="comment">/* Process an NMI */</span>
00064 <span class="keyword">extern</span> void (*mtrr_hook) (<span class="keywordtype">void</span>);
00065 <span class="keyword">extern</span> <span class="keywordtype">void</span> zap_low_mappings (<span class="keywordtype">void</span>);
00066 
00067 <span class="comment">/*</span>
00068 <span class="comment"> * On x86 all CPUs are mapped 1:1 to the APIC space.</span>
00069 <span class="comment"> * This simplifies scheduling and IPI sending and</span>
00070 <span class="comment"> * compresses data structures.</span>
00071 <span class="comment"> */</span>
00072 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> cpu_logical_map(<span class="keywordtype">int</span> cpu)
00073 {
00074     <span class="keywordflow">return</span> cpu;
00075 }
00076 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> cpu_number_map(<span class="keywordtype">int</span> cpu)
00077 {
00078     <span class="keywordflow">return</span> cpu;
00079 }
00080 
00081 <span class="comment">/*</span>
00082 <span class="comment"> * Some lowlevel functions might want to know about</span>
00083 <span class="comment"> * the real APIC ID &lt;-&gt; CPU # mapping.</span>
00084 <span class="comment"> */</span>
00085 <span class="preprocessor">#define MAX_APICID 256</span>
00086 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="smpboot_8h.html#a8">cpu_to_physical_apicid</a>[<a class="code" href="apic_8h.html#a0">NR_CPUS</a>];
00087 <span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="smpboot_8h.html#a7">physical_apicid_to_cpu</a>[MAX_APICID];
00088 <span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="smpboot_8h.html#a6">cpu_to_logical_apicid</a>[<a class="code" href="apic_8h.html#a0">NR_CPUS</a>];
00089 <span class="keyword">extern</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="smpboot_8h.html#a5">logical_apicid_to_cpu</a>[MAX_APICID];
00090 
00091 <span class="comment">/*</span>
00092 <span class="comment"> * General functions that each host system must provide.</span>
00093 <span class="comment"> */</span>
00094  
00095 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="smpboot_8c.html#a58">smp_boot_cpus</a>(<span class="keywordtype">void</span>);
00096 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="smpboot_8c.html#a40">smp_store_cpu_info</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);     <span class="comment">/* Store per CPU info (like the initial udelay numbers */</span>
00097 
00098 <span class="comment">/*</span>
00099 <span class="comment"> * This function is needed by all SMP systems. It must _always_ be valid</span>
00100 <span class="comment"> * from the initial startup. We map APIC_BASE very early in page_setup(),</span>
00101 <span class="comment"> * so this is correct in the x86 case.</span>
00102 <span class="comment"> */</span>
00103 
00104 <span class="preprocessor">#define smp_processor_id() (current-&gt;processor)</span>
00105 <span class="preprocessor"></span>
00106 <span class="keyword">static</span> __inline <span class="keywordtype">int</span> hard_smp_processor_id(<span class="keywordtype">void</span>)
00107 {
00108     <span class="comment">/* we don't want to mark this access volatile - bad code generation */</span>
00109     <span class="keywordflow">return</span> <a class="code" href="apicdef_8h.html#a3">GET_APIC_ID</a>(*(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)(APIC_BASE+APIC_ID));
00110 }
00111 
00112 <span class="keyword">static</span> __inline <span class="keywordtype">int</span> logical_smp_processor_id(<span class="keywordtype">void</span>)
00113 {
00114     <span class="comment">/* we don't want to mark this access volatile - bad code generation */</span>
00115     <span class="keywordflow">return</span> <a class="code" href="apicdef_8h.html#a19">GET_APIC_LOGICAL_ID</a>(*(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)(APIC_BASE+APIC_LDR));
00116 }
00117 
00118 <span class="preprocessor">#endif </span><span class="comment">/* !__ASSEMBLY__ */</span>
00119 
00120 <span class="preprocessor">#define NO_PROC_ID      0xFF        </span><span class="comment">/* No processor magic marker */</span>
00121 
00122 <span class="comment">/*</span>
00123 <span class="comment"> *  This magic constant controls our willingness to transfer</span>
00124 <span class="comment"> *  a process across CPUs. Such a transfer incurs misses on the L1</span>
00125 <span class="comment"> *  cache, and on a P6 or P5 with multiple L2 caches L2 hits. My</span>
00126 <span class="comment"> *  gut feeling is this will vary by board in value. For a board</span>
00127 <span class="comment"> *  with separate L2 cache it probably depends also on the RSS, and</span>
00128 <span class="comment"> *  for a board with shared L2 cache it ought to decay fast as other</span>
00129 <span class="comment"> *  processes are run.</span>
00130 <span class="comment"> */</span>
00131  
00132 <span class="preprocessor">#define PROC_CHANGE_PENALTY 15      </span><span class="comment">/* Schedule penalty */</span>
00133 
00134 <span class="preprocessor">#endif</span>
00135 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</div></pre>  </body>
</html>
